#include <stdio.h>
#include <string.h>
#include <ctype.h>
#include <math.h>

int main() {
    char text[100], clean[100], cipher[100], plain[100];
    int key, i, j, idx = 0;

    printf("Enter text (no spaces): ");
    scanf("%s", text);  // no spaces input
    printf("Enter key: ");
    scanf("%d", &key);

    // Convert to uppercase
    int len = 0;
    for (i = 0; text[i]; i++)
        clean[len++] = toupper(text[i]);
    clean[len] = '\0';

    int row = ceil((float)len / key);
    char mat[20][20] = {0};

    // Fill row-wise
    idx = 0;
    for (i = 0; i < row; i++)
        for (j = 0; j < key; j++)
            if (idx < len) mat[i][j] = clean[idx++];

    // Read column-wise to get cipher
    idx = 0;
    for (j = 0; j < key; j++)
        for (i = 0; i < row; i++)
            if (mat[i][j] != 0) cipher[idx++] = mat[i][j];
    cipher[idx] = '\0';

    printf("\nEncrypted Text: %s\n", cipher);

    // Fill column-wise for decryption
    idx = 0;
    for (j = 0; j < key; j++)
        for (i = 0; i < row; i++)
            if (idx < len) mat[i][j] = cipher[idx++];

    // Read row-wise to get plaintext
    idx = 0;
    for (i = 0; i < row; i++)
        for (j = 0; j < key; j++)
            if (mat[i][j] != 0) plain[idx++] = mat[i][j];
    plain[idx] = '\0';

    printf("Decrypted Text: %s\n", plain);
    return 0;
}
